ARG GRADLE_BASE_IMAGE_VERSION=8.8.0-jdk21
ARG INIT_SCRIPT_PATH=init-scripts/develocity-injection.init.gradle
FROM gradle:$GRADLE_BASE_IMAGE_VERSION

# Env vars that should be set at runtime
ENV DEVELOCITY_URL=https://scans.gradle.com
#ENV DEVELOCITY_ACCESS_KEY=***
ENV DEVELOCITY_SHORT_LIVED_TOKEN_EXPIRY=2
ENV DEVELOCITY_INJECTION_ENABLED=true
ENV DEVELOCITY_INJECTION_INIT_SCRIPT_NAME=init.gradle
ENV DEVELOCITY_AUTO_INJECTION_CUSTOM_VALUE=GitLab
ENV DEVELOCITY_PLUGIN_VERSION=3.17.5
ENV DEVELOCITY_CCUD_PLUGIN_VERSION=2.0.2
ENV DEVELOCITY_ALLOW_UNTRUSTED_SERVER=false
ENV DEVELOCITY_ENFORCE_URL=false
ENV DEVELOCITY_CAPTURE_FILE_FINGERPRINTS=true
ENV GRADLE_PLUGIN_REPOSITORY_URL=https://plugins.gradle.org/m2
ENV GRADLE_PLUGIN_REPOSITORY_USERNAME=""
ENV GRADLE_PLUGIN_REPOSITORY_PASSWORD=""

COPY $INIT_SCRIPT_PATH $GRADLE_HOME/init.d/$DEVELOCITY_INJECTION_INIT_SCRIPT_NAME

COPY inject-wrapper.sh /inject-wrapper.sh
RUN chmod +x /inject-wrapper.sh

ENTRYPOINT ["/inject-wrapper.sh"]
